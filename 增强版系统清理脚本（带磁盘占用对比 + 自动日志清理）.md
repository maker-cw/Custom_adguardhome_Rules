🧹 二、增强版系统清理脚本（带磁盘占用对比 + 自动日志清理）

请更新脚本 /usr/local/bin/clean_system.sh：

#!/bin/bash
# ==========================================
# Debian 自动清理脚本（增强版）
# 作者：ChatGPT + 你 😊
# ==========================================

LOGFILE="/var/log/clean_system.log"

# 将所有输出重定向到日志
exec > >(tee -a "$LOGFILE") 2>&1

echo "=========================================="
echo "🧹 系统清理开始：$(date)"

# 记录清理前磁盘使用率
echo "------------------------------------------"
echo "📊 清理前磁盘使用情况："
df -h /

# 1. 清理APT缓存
echo "👉 清理APT缓存..."
apt-get autoremove -y
apt-get autoclean -y
apt-get clean -y

# 2. 清理系统日志（仅保留7天内）
echo "👉 清理旧系统日志..."
find /var/log -type f -name "*.log" -mtime +7 -exec truncate -s 0 {} \;

# 3. 清理临时文件夹
echo "👉 清理临时文件..."
rm -rf /tmp/*
rm -rf /var/tmp/*

# 4. 清理Docker垃圾（如果有）
if command -v docker &> /dev/null; then
    echo "👉 清理Docker无用镜像、容器、卷..."
    docker system prune -af
fi

# 5. 同步磁盘
sync

# 6. 清理旧日志文件（超过30天的删除）
echo "👉 删除30天前的旧日志..."
find /var/log -name "clean_system.log*" -mtime +30 -delete

# 7. 记录清理后磁盘使用率
echo "------------------------------------------"
echo "📊 清理后磁盘使用情况："
df -h /

echo "✅ 清理完成！$(date)"
echo "=========================================="
echo




给脚本执行权限
sudo chmod +x /usr/local/bin/clean_system.sh


再手动执行：

sudo /usr/local/bin/clean_system.sh


🪄 三、重新设置定时任务

确保 cron 任务以 root 身份 编辑：

sudo crontab -e


在文件最顶部加上环境变量行（非常关键）：

PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin


然后添加定时任务（例：每周日凌晨 3 点）：

0 3 * * 0 /usr/local/bin/clean_system.sh >> /var/log/clean_system.log 2>&1


保存退出。

🧾 四、手动测试一次

先创建日志文件并赋权（确保可写）：

sudo touch /var/log/clean_system.log
sudo chmod 666 /var/log/clean_system.log





执行后查看日志：

sudo tail -n 20 /var/log/clean_system.log


你应该能看到清理前后磁盘使用对比，比如：
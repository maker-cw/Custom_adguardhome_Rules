ğŸ§­ ä¸€ã€åŠŸèƒ½è¯´æ˜

è„šæœ¬åŠŸèƒ½å¦‚ä¸‹ğŸ‘‡ï¼š

åŠŸèƒ½	è¯´æ˜
âœ… è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿè¿è¡Œå¤©æ•°	
âœ… è¶…è¿‡è®¾å®šå¤©æ•°ï¼ˆé»˜è®¤ 15 å¤©ï¼‰è‡ªåŠ¨é‡å¯	
âœ… æ¯æ¬¡æ£€æµ‹å†™å…¥æ—¥å¿—ï¼ˆå«æ—¶é—´ã€è¿è¡Œæ—¶é•¿ã€æ˜¯å¦é‡å¯ï¼‰	
âœ… è‡ªåŠ¨æ¸…ç†è¶…è¿‡ 30 å¤©çš„æ—§æ—¥å¿—	
âœ… å¯ä¸ cron å®šæ—¶ä»»åŠ¡é…åˆï¼Œæ¯å¤©è‡ªåŠ¨æ£€æµ‹ä¸€æ¬¡	
ğŸ’» äºŒã€è„šæœ¬ç¼–å†™
1ï¸âƒ£ åˆ›å»ºè„šæœ¬æ–‡ä»¶

åœ¨ Debian ä¸Šæ‰§è¡Œï¼š

sudo nano /usr/local/bin/auto_reboot_check.sh


2ï¸âƒ£ ç²˜è´´ä»¥ä¸‹å®Œæ•´è„šæœ¬å†…å®¹ï¼š

'''
#!/bin/bash
# ====================================================
# Debian è‡ªåŠ¨æ£€æµ‹è¿è¡Œæ—¶é—´å¹¶å®šæœŸé‡å¯è„šæœ¬
# ä½œè€…ï¼šChatGPT + ä½  â¤ï¸
# åŠŸèƒ½ï¼šæ£€æµ‹ç³»ç»Ÿè¿è¡Œå¤©æ•°ï¼Œè¶…è¿‡é˜ˆå€¼åˆ™è‡ªåŠ¨é‡å¯
# ====================================================

# æ—¥å¿—è·¯å¾„
LOGFILE="/var/log/auto_reboot_check.log"

# é˜ˆå€¼ï¼ˆå•ä½ï¼šå¤©ï¼‰â€”â€” è¿è¡Œè¶…è¿‡å¤šå°‘å¤©åè‡ªåŠ¨é‡å¯
MAX_DAYS=15

# è·å–ç³»ç»Ÿè¿è¡Œç§’æ•°ï¼ˆä» /proc/uptime å–ï¼‰
UPTIME_SECONDS=$(awk '{print int($1)}' /proc/uptime)

# è®¡ç®—å·²è¿è¡Œå¤©æ•°
UPTIME_DAYS=$((UPTIME_SECONDS / 86400))

# è·å–å½“å‰æ—¶é—´
NOW=$(date "+%Y-%m-%d %H:%M:%S")

# å†™å…¥æ—¥å¿—æ–‡ä»¶
echo "[$NOW] ğŸ•’ ç³»ç»Ÿå·²è¿è¡Œ ${UPTIME_DAYS} å¤©ã€‚" >> "$LOGFILE"

# åˆ¤æ–­æ˜¯å¦è¶…è¿‡è®¾å®šå¤©æ•°
if [ "$UPTIME_DAYS" -ge "$MAX_DAYS" ]; then
    echo "[$NOW] âš ï¸ è¿è¡Œæ—¶é—´è¶…è¿‡ ${MAX_DAYS} å¤©ï¼Œç³»ç»Ÿå³å°†è‡ªåŠ¨é‡å¯..." >> "$LOGFILE"
    
    # è®°å½•é‡å¯æ—¥å¿—
    echo "[$NOW] ğŸš€ æ‰§è¡Œç³»ç»Ÿé‡å¯ï¼" >> "$LOGFILE"
    
    # æ¸…ç†æ—§æ—¥å¿—ï¼ˆ30 å¤©å‰ï¼‰
    find /var/log -type f -name "auto_reboot_check.log*" -mtime +30 -delete
    
    # å»¶æ—¶ 60 ç§’å†é‡å¯ï¼ˆå¯æ”¹ä¸º 0 ç«‹å³æ‰§è¡Œï¼‰
    sleep 60
    /sbin/reboot
else
    echo "[$NOW] âœ… è¿è¡Œæ—¶é—´æœªè¶…é™ï¼ˆ${UPTIME_DAYS}/${MAX_DAYS} å¤©ï¼‰ï¼Œæ— éœ€é‡å¯ã€‚" >> "$LOGFILE"
fi


'''
3ï¸âƒ£ ä¿å­˜å¹¶é€€å‡º

æŒ‰ï¼š

Ctrl + O â†’ å›è½¦ â†’ Ctrl + X

4ï¸âƒ£ èµ‹äºˆæ‰§è¡Œæƒé™
sudo chmod +x /usr/local/bin/auto_reboot_check.sh

â° ä¸‰ã€è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼ˆcronï¼‰

è®©ç³»ç»Ÿæ¯å¤©è‡ªåŠ¨æ£€æµ‹ä¸€æ¬¡ï¼ˆä¾‹å¦‚æ¯å¤©å‡Œæ™¨ 3 ç‚¹ï¼‰ï¼š

sudo crontab -e


åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ  PATHï¼ˆé˜²æ­¢å‘½ä»¤æ‰¾ä¸åˆ°ï¼‰ï¼š

PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin


ç„¶ååœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ï¼š

0 3 * * * /usr/local/bin/auto_reboot_check.sh >> /var/log/auto_reboot_check.log 2>&1


è¯´æ˜ï¼š

0 3 * * * â†’ æ¯å¤©å‡Œæ™¨ 3 ç‚¹æ‰§è¡Œ

>> è¡¨ç¤ºè¿½åŠ æ—¥å¿—

2>&1 è¡¨ç¤ºæ•è·é”™è¯¯è¾“å‡º

ğŸ“– å››ã€æ—¥å¿—æŸ¥çœ‹ä¸éªŒè¯

æŸ¥çœ‹æœ€è¿‘æ—¥å¿—ï¼š

sudo tail -n 20 /var/log/auto_reboot_check.log


æ‰‹åŠ¨æµ‹è¯•è„šæœ¬ï¼ˆä¸ä¼šé‡å¯ï¼Œå› ä¸ºæœªåˆ°å¤©æ•°ï¼‰ï¼š

sudo /usr/local/bin/auto_reboot_check.sh


æ¨¡æ‹Ÿæµ‹è¯•ï¼ˆå¼ºåˆ¶è§¦å‘é‡å¯ï¼‰ï¼š

sudo MAX_DAYS=0 /usr/local/bin/auto_reboot_check.sh